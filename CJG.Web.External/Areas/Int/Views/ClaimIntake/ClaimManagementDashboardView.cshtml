@{
    ViewBag.Title = "Claim Management";
}
<div id="claim-management-dashboard" ng-controller="ClaimManagementDashboard">
    <div>
        <h2>Claim Management Dashboard</h2>
    </div>
    <div class="form__group-set">
        <div class="form__group">
            <label class="form__label" for="">Fiscal Year</label>
            <div class="form__control">
                <div class="selectmenu">
                    <select ng-model="model.SelectedFiscalYearId" ng-options="item.Key as item.Value for item in fiscalYears" ng-change="loadGrantPrograms()"></select>
                </div>
            </div>
        </div>
        <div class="form__group">
            <label class="form__label" for="">Grant Program</label>
            <div class="form__control">
                <div class="selectmenu input--medium">
                    <select ng-model="model.SelectedGrantProgramId" ng-options="item.Key as item.Value for item in grantPrograms" class="input--medium" ng-change="loadGrantStreams()">
                        <option value="">@DropDownListHelper.SelectValueText</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="form__group">
            <label class="form__label" for="">Grant Stream</label>
            <div class="form__control">
                <div class="selectmenu input--medium">
                    <select ng-model="model.SelectedGrantStreamId" ng-options="item.Key as item.Value for item in grantStreams" class="input--medium" ng-change="refresh()">
                        <option value="">@DropDownListHelper.SelectValueText</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="form__group">
            <label class="form__label" for="">&nbsp;</label>
            <div class="form__control">
                <button class="btn btn--primary" ng-click="refresh()">Refresh</button>
            </div>
        </div>
    </div>

    <div ng-if="alert.message" class="row row--alert">
        <div class="alert" ng-class="'alert--' + alert.type" role="alert" ng-bind-html="alert.message"></div>
    </div>

    <div class="table--horizontal-wrapper js-claims-dashboard">
        <table class="table--datatable-horizontal nowrap table--claim-management-dashboard">
            <thead>
                <tr>
                    <th></th>
                    <th colspan="1">
                        <button class="btn btn--primary" type="button"
                                title="You should enter rates that improve the Projection of Performance to Budget by discounting outstanding commitments and claims for slippage and cancellations. Enter your discount rates below and then click Save.  You may also vary the rates (without saving them) to explore various projections of performance to budget."
                                ng-click="save()"
                                ng-disabled="!model.AllowToSave">
                            Save Rates(%)
                        </button>
                    </th>
                    <th colspan="2" ng-repeat="period in model.DataColumns">{{period.Name}}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Total Number of Agreements</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class="text-align-right">% of</td>
                    <td ng-repeat-end class="text-align-right">{{period.TotalAgreementsCount}}</td>
                </tr>
                <tr data-row="outstanding-commitments">
                    <th>Current Unclaimed Commitments</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class="text-align-right">
                        {{period.UnclaimedCommitments.Percent | percentageParentheses : 2}}
                    </td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.UnclaimedCommitments.Amount < 0}">{{period.UnclaimedCommitments.Amount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr data-row="agreement-slippage-rate">
                    <th class="indent-cell">Slippage</th>
                    <td>
                        <input type="text" ng-model="model.UnclaimedSlippageRate" class="input--small" ng-percent ng-disabled="!model.AllowToSave" ng-keypress="calculateAfterKeypress()" />
                    </td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.UnclaimedSlipageAmount < 0}">{{period.UnclaimedSlipageAmount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr>
                    <th class="indent-cell">Cancellations</th>
                    <td>
                        <input type="text" ng-model="model.UnclaimedCancellationRate" class="input--small" ng-percent ng-disabled="!model.AllowToSave" ng-keypress="calculateAfterKeypress()" />
                    </td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.UnclaimedCancellationAmount < 0}">{{period.UnclaimedCancellationAmount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr>
                    <th>Current Claims Received</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class="text-align-right">
                        <span ng-if="model.ClaimType != @((int)CJG.Core.Entities.ClaimTypes.MultipleClaimsWithoutAmendments)">
                            {{period.ClaimsReceivedAmount.Percent | percentageParentheses : 2}}
                        </span>
                    </td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.ClaimsReceivedAmount.Amount < 0}">{{period.ClaimsReceivedAmount.Amount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr>
                    <th class="indent-cell">Claim Slippage</th>
                    <td>
                        <input type="text" ng-model="model.ClaimedSlippageRate" class="input--small" ng-percent ng-disabled="!model.AllowToSave" ng-change="calculateAfterKeypress()"/>
                    </td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.ClaimsSlippageAmount < 0}">{{period.ClaimsSlippageAmount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr>
                    <th>Current Payment Requests</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class="text-align-right">
                        {{period.PaymentRequests.Percent | percentageParentheses : 2}}
                    </td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.PaymentRequests.Amount < 0}">{{period.PaymentRequests.Amount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td class="background-color-white" colspan="{{(model.DataColumns.length * 2 + 2)}}"></td>
                </tr>
                <tr>
                    <th>Projection of Performance to Budget</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.ProjectionOfPerformanceAmount < 0}">{{period.ProjectionOfPerformanceAmount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>

                <tr>
                    <th>Budget Allocation</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.BudgetAllocationAmount < 0}">{{period.BudgetAllocationAmount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>
                <tr>
                    <th>Over / <span class="error">(Under)</span> $</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span ng-class="{'error': period.OverUnderBudget.Amount < 0}">{{period.OverUnderBudget.Amount | currencyParentheses : "$" : 0}}</span>
                    </td>
                </tr>

                <tr>
                    <th>Over / <span class="error">(Under)</span> %</th>
                    <td></td>
                    <td ng-repeat-start="period in model.DataColumns" class=""></td>
                    <td ng-repeat-end class="text-align-right">
                        <span class="with-percent-sign" ng-class="{'error': period.OverUnderBudget.Percent < 0}">{{period.OverUnderBudget.Percent | percentageParentheses : 2}}</span>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
